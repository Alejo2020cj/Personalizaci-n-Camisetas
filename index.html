<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cyberpunk T-Shirt Customizer</title>
<style>
/* --- ESTILO CYBERPUNK --- */
body {
  background: #0a0a0f;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  color: #f2f2f2;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h1 {
  margin-top: 20px;
  color: #00eaff;
  font-size: 28px;
  text-shadow: 0 0 8px #00eaff;
}

.container {
  width: 95%;
  max-width: 480px;
  margin-top: 20px;
}

button, label {
  width: 100%;
  display: block;
  margin: 10px 0;
  padding: 12px;
  background: #12121a;
  border: 2px solid #00eaff;
  border-radius: 10px;
  color: #00eaff;
  font-size: 16px;
  text-align: center;
  cursor: pointer;
  box-shadow: 0 0 10px #00eaff55;
}

button:hover, label:hover {
  background: #00eaff33;
}

#canvasWrapper {
  margin-top: 25px;
  width: 100%;
  background: #111;
  padding: 10px;
  border: 2px solid #00eaff55;
  border-radius: 12px;
}

canvas {
  width: 100%;
  background: #000;
  border-radius: 10px;
}

/* --- √ÅREA DE EDICI√ìN (CUADRO DE REDIMENSI√ìN) --- */
#editBox {
  position: absolute;
  border: 2px dashed #00eaff;
  display: none;
}

.resizeHandle {
  width: 18px;
  height: 18px;
  background: #00eaff;
  position: absolute;
  border-radius: 50%;
}

.resizeHandle.br { bottom: -10px; right: -10px; }
.resizeHandle.bl { bottom: -10px; left: -10px; }
.resizeHandle.tr { top: -10px; right: -10px; }
.resizeHandle.tl { top: -10px; left: -10px; }
</style>
</head>
<body>
<h1>Cyberpunk T-Shirt Customizer</h1>

<div class="container">
  <button id="btnEllas">Ellas</button>
  <button id="btnEllos">Ellos</button>

  <label for="uploadMockup">Subir mi propio mockup</label>
  <input type="file" id="uploadMockup" accept="image/*" style="display:none;" />

  <label for="uploadDesign">Subir dise√±o</label>
  <input type="file" id="uploadDesign" accept="image/*" style="display:none;" />

  <button id="downloadBtn">Descargar Camiseta</button>
</div>

<div id="canvasWrapper">
  <canvas id="canvas" width="800" height="1000"></canvas>
</div>

<div id="editBox">
  <div class="resizeHandle tl"></div>
  <div class="resizeHandle tr"></div>
  <div class="resizeHandle bl"></div>
  <div class="resizeHandle br"></div>
</div>

<script>
/* ============================================================
   CONFIGURACI√ìN
   ============================================================ */
const MOCKUP_ELLAS = "mockup_ellas.jpg";
const MOCKUP_ELLOS = "mockup_ellos.jpg";

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let mockup = new Image();
let design = new Image();
let designLoaded = false;
let mockupLoaded = false;

let dX = 200, dY = 330, dW = 350, dH = 350;
let dragging = false;
let resizing = false;
let resizeDir = "";
let offsetX = 0;
let offsetY = 0;

const editBox = document.getElementById("editBox");

/* ============================================================
   üî• PRELOAD PARA EVITAR LAG EN CELULAR
   ============================================================ */
const preloadEllas = new Image();
const preloadEllos = new Image();

preloadEllas.src = MOCKUP_ELLAS;
preloadEllos.src = MOCKUP_ELLOS;

/* Esta funci√≥n usa los preloads ya decodificados */
function loadMockupPreloaded(img) {
  mockup = img;
  mockupLoaded = true;
  draw();
}

/* ============================================================ */
function loadDesign(src) {
  design = new Image();
  design.crossOrigin = "anonymous";
  design.onload = () => { designLoaded = true; showEditBox(); draw(); };
  design.src = src;
}

/* BOTONES */
btnEllas.onclick = () => {
  loadMockupPreloaded(preloadEllas);
};

btnEllos.onclick = () => {
  loadMockupPreloaded(preloadEllos);
};

/* Upload mockup (sin preload porque viene del usuario) */
uploadMockup.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  const img = new Image();
  img.onload = () => { mockup = img; mockupLoaded = true; draw(); };
  img.src = URL.createObjectURL(file);
};

/* Upload dise√±o */
uploadDesign.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  loadDesign(URL.createObjectURL(file));
};

/* ============================================================
   DIBUJO
   ============================================================ */
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if (mockupLoaded) ctx.drawImage(mockup,0,0,canvas.width,canvas.height);
  if (designLoaded) ctx.drawImage(design, dX, dY, dW, dH);
}

/* ============================================================
   EDITBOX
   ============================================================ */
function showEditBox() {
  editBox.style.display = "block";
  editBox.style.left = dX + "px";
  editBox.style.top = dY + "px";
  editBox.style.width = dW + "px";
  editBox.style.height = dH + "px";
}

function getPos(e) {
  if (e.touches) return {
    x: e.touches[0].clientX - canvas.getBoundingClientRect().left,
    y: e.touches[0].clientY - canvas.getBoundingClientRect().top
  };
  return {
    x: e.clientX - canvas.getBoundingClientRect().left,
    y: e.clientY - canvas.getBoundingClientRect().top
  };
}

canvas.addEventListener("mousedown", startDrag);
canvas.addEventListener("touchstart", startDrag);

function startDrag(e) {
  const pos = getPos(e);
  if(pos.x > dX && pos.x < dX+dW && pos.y > dY && pos.y < dY+dH){
    dragging = true;
    offsetX = pos.x - dX;
    offsetY = pos.y - dY;
    showEditBox();
  }
}

window.addEventListener("mousemove", moveDrag);
window.addEventListener("touchmove", moveDrag);

function moveDrag(e) {
  if (!dragging && !resizing) return;
  const pos = getPos(e);

  if (dragging) {
    dX = pos.x - offsetX;
    dY = pos.y - offsetY;
    draw();
    showEditBox();
  }
}

window.addEventListener("mouseup", endDrag);
window.addEventListener("touchend", endDrag);

function endDrag(){ dragging = false; resizing = false; }

/* ============================================================
   DESCARGA
   ============================================================ */
downloadBtn.addEventListener("click", () => {
  draw();
  canvas.toBlob(blob => {
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "camiseta.png";
    a.click();
  });
});
</script>
</body>
</html>
